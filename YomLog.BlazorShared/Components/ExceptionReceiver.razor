@using YomLog.BlazorShared.Services.Popup
@using YomLog.Shared.Exceptions
@inherits BindableComponentBase
@inject ExceptionHubService ExceptionHub
@inject IDialogService DialogService

@code {
    protected override void OnInitialized()
    {
        ExceptionHub.Exception
            .ObserveOnMainThread()
            .Where(v => v != null)
            .Subscribe(async v =>
            {
                ExceptionHub.Exception.Value = null;

                // If switched to offline mode, do nothing.
                if (v is IApiException ex && ex.StatusCode is null) return;

                await ExceptionDialog.ShowDialog(DialogService, v!);
                // NOTE: Exception from another thread cannot catch with error boundary.
                // InvokeAsync(() => throw v!);
            })
            .AddTo(Disposable);
    }
}