@using System.Net
@using YomLog.Shared.Exceptions

@inherits BindableComponentBase
@inject IDialogService DialogService

<MudThemeProvider @ref="@_mudThemeProvider"
                  Theme="new MudTheme()"
                  @bind-IsDarkMode="LayoutService.IsDarkMode.Value" />
<MudDialogProvider FullWidth="true"
                   MaxWidth="MaxWidth.Small"
                   CloseButton="false"
                   DisableBackdropClick="true"
                   NoHeader="false"
                   Position="DialogPosition.Center"
                   CloseOnEscapeKey="false" />
<MudSnackbarProvider />

<MudLayout>
    <MudSwipeArea OnSwipe="@OnSwipe" Style="width: 100%; height:100vh;">
        @AppBarSection

        @if (DrawerSection != null)
        {
            @DrawerSection
        }

        <MudMainContent Class="@LayoutService.Page.Value?.MainContentClass">
            <ErrorBoundary @ref="_errorBoundary">
                <ChildContent>
                    <ExceptionReceiver />

                    <MudOverlay Visible="LayoutService.IsProcessing.Value" DarkBackground="true">
                        <MudProgressCircular Color="Color.Secondary" Indeterminate="true" Size="Size.Large" />
                    </MudOverlay>

                    @ChildContent
                </ChildContent>
                <ErrorContent>
                    @if (context is NotFoundException)
                    {
                        @if (NotFoundSection != null)
                        {
                            @NotFoundSection
                        }
                        else
                        {
                            <NotFoundPage />
                        }
                    }
                    else
                    {
                        _ = ExceptionDialog.ShowDialog(DialogService, context, _errorBoundary);
                    }
                </ErrorContent>
            </ErrorBoundary>
        </MudMainContent>

        @if (LayoutService.Page.Value?.FooterContent != null)
        {
            @LayoutService.Page.Value.FooterContent
        }
    </MudSwipeArea>
</MudLayout>